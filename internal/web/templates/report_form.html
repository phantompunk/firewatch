{{define "report_form.html"}}<!DOCTYPE html>
<html lang="{{.CurrentLang}}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{.Page.Title}}</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
</head>
<body>
<main class="form-container">
  <header class="form-header">
    <h1>{{.Page.Title}}</h1>
    {{if .Page.Subtitle}}<p class="subtitle">{{.Page.Subtitle}}</p>{{end}}
  </header>

  {{if gt (len .Languages) 1}}
  <nav class="lang-toggle">
    {{range .Languages}}
    <a href="?lang={{.Code}}" class="lang-btn{{if eq .Code $.CurrentLang}} active{{end}}">{{.Name}}</a>
    {{end}}
  </nav>
  {{end}}

  <form id="report-form">
    {{range .Fields}}
    {{if eq .Type "accordion"}}
    <details class="field-group accordion-field">
      <summary>{{.Label}}</summary>
      {{if .Description}}<p>{{.Description}}</p>{{end}}
    </details>
    {{else}}
    <section class="field-group">
      <h2 class="field-label">{{.Label}}{{if .Required}} <span class="required">*</span>{{end}}</h2>
      {{if .Description}}<p class="field-desc">{{.Description}}</p>{{end}}
      {{if eq .Type "textarea"}}
      <textarea id="{{.ID}}" name="fields[{{.ID}}]" placeholder="{{.Placeholder}}"{{if .Required}} required{{end}} rows="3"></textarea>
      {{else if eq .Type "select"}}
      <select id="{{.ID}}" name="fields[{{.ID}}]"{{if .Required}} required{{end}}>
        <option value="">-- Select --</option>
        {{range .Options}}<option value="{{.}}">{{.}}</option>{{end}}
      </select>
      {{else}}
      <input type="text" id="{{.ID}}" name="fields[{{.ID}}]" placeholder="{{.Placeholder}}"{{if .Required}} required{{end}}>
      {{end}}
    </section>
    {{end}}
    {{end}}

    <div class="hp-field" aria-hidden="true">
      <label for="_hp">Website</label>
      <input type="text" id="_hp" name="_hp" tabindex="-1" autocomplete="off">
    </div>
    <input type="hidden" id="_t" name="_t" value="{{.FormTimestamp}}">

    <button type="submit">{{.Page.SubmitButtonLabel}}</button>
  </form>
  <div id="form-message" style="display:none"></div>
</main>
<script>
document.getElementById('report-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const fd = new FormData(this);
  const data = { fields: {}, _hp: fd.get('_hp') || '', _t: parseInt(fd.get('_t') || '0', 10) };
  fd.forEach((v, k) => {
    const m = k.match(/^fields\[(.+)\]$/);
    if (m) data.fields[m[1]] = v;
  });
  const res = await fetch('/api/report', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  const msg = document.getElementById('form-message');
  if (res.ok) {
    this.style.display = 'none';
    msg.style.display = '';
    msg.textContent = 'Your report has been submitted. Thank you.';
  } else {
    msg.style.display = '';
    msg.textContent = 'Submission failed. Please try again.';
  }
});
</script>
</body>
</html>
{{end}}
